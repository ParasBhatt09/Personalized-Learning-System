<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LearnHub - Learn Smarter, Achieve More</title>
  <link rel="stylesheet" href="style.css" />
</head>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  background: linear-gradient(to bottom right, #98fff6, #faf7ff);
  color: #333;
}

.navbar {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 60px;
  background: #fff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo img {
  width: 35px;
  height: 35px;
}

.logo h2 {
  color: #7a3ef5;
  font-size: 22px;
  font-weight: 700;
}

.username {
  margin-left: 15px;
  font-size: 18px;
  font-weight: 600;
  color: #3d7bf2;
}

.logout-btn {
  background: #ff4d4d;
  color: white;
  padding: 10px 18px;
  border-radius: 18px;
  font-weight: 600;
  cursor: pointer;
  border: none;
  margin-left: 20px;
}

.logout-btn:hover {
  background: #e60000;
}
nav a {
  margin: 0 15px;
  text-decoration: none;
  color: #333;
  font-weight: 500;
  cursor: pointer;
}

.nav-buttons {
  display: flex;
  align-items: center;
  gap: 10px;
}

</style>

<body>
<header class="navbar">
  <div class="logo">
    <img src="https://cdn-icons-png.flaticon.com/512/1048/1048943.png" alt="Logo" />
    <h2>LearnHub</h2>
    <% if (user) { %>
      <span class="username">
        Welcome <%= user.name %> ( Student ID: <%= user.studentId %>)
      </span>
    <% } %>
  </div>

  <nav>
    <a href="/subject" id="nav-courses">subjects</a>
    <a href="/learn" id="nav-learning">My Learning</a>
    <a href="#" id="nav-about">About</a>

    <form action="/logout" method="GET" style="display:inline;">
      <button class="logout-btn">Logout</button>
    </form>
  </nav>
</header>

<main id="main-content">

  <div id="full-main">
    <section class="hero" id="hero-section">
      <div class="hero-text">
        <button class="tagline">Transform Your Learning Journey</button>
        <h1>Learn Smarter, <span>Achieve More</span></h1>
        <p>Join thousands of students from grades 1‚Äì12 in mastering core subjects through interactive lessons.</p>

        <div class="buttons">
          <button class="primary explore-courses-btn">Explore Courses ‚Üí</button>
          <button class="secondary">Learn More</button>
        </div>

        <div class="students-card">
          <p><strong>1000+ Students</strong><br>Enrolled This Month</p>
        </div>

      </div>
    </section>
    <div class="container" id="grade-cards-main">

  <!-- Grade 1‚Äì3 -->
  <form action="/course" method="GET">
    <div class="card">
      <div class="card-icon purple">üéì</div>
      <h3>Grade 1-3</h3>
      <p>Primary</p>
      <input type="hidden" name="gradeRange" value="1-3">
      <button type="submit" class="choose-grade-btn">Explore Courses ‚Üí</button>
    </div>
  </form>

  <!-- Grade 4‚Äì6 -->
  <form action="/course" method="GET">
    <div class="card">
      <div class="card-icon blue">üéì</div>
      <h3>Grade 4-6</h3>
      <p>Elementary</p>
      <input type="hidden" name="gradeRange" value="4-6">
      <button type="submit" class="choose-grade-btn">Explore Courses ‚Üí</button>
    </div>
  </form>

  <!-- Grade 7‚Äì9 -->
  <form action="/course" method="GET">
    <div class="card">
      <div class="card-icon orange">üéì</div>
      <h3>Grade 7-9</h3>
      <p>Middle School</p>
      <input type="hidden" name="gradeRange" value="7-9">
      <button type="submit" class="choose-grade-btn">Explore Courses ‚Üí</button>
    </div>
  </form>

  <!-- Grade 10‚Äì12 -->
  <form action="/course" method="GET">
    <div class="card">
      <div class="card-icon violet">üéì</div>
      <h3>Grade 10-12</h3>
      <p>High School</p>
      <input type="hidden" name="gradeRange" value="10-12">
      <button type="submit" class="choose-grade-btn">Explore Courses ‚Üí</button>
    </div>
  </form>

</div>
</main>
<!-- Include chatbot everywhere -->
<div id="chatbot-container">
  <div class="chatbot">
    <button class="chatbot-toggler">üí¨</button>
<link rel="stylesheet" href="chatbot.css" />

    <div class="chatbot-window">
      <div class="chatbot-header">
        <h3>LearnHub Assistant</h3>
      </div>

      <div class="chatbot-body" id="chat-body">
        <div class="bot-message">
          üëã Hi! I‚Äôm your LearnHub assistant.<br><br>
          <b>You can ask me for YouTube study videos like:</b><br>
          ‚Ä¢ Recommend a video for Class 5 Science<br>
          ‚Ä¢ Show Class 10 Maths Trigonometry video<br>
          ‚Ä¢ Video for Class 3 English grammar<br><br>
          I'm here to help you learn! üòä
        </div>
      </div>

      <div class="chatbot-input">
        <input type="text" id="user-input" placeholder="Type your question..." />
        <button id="send-btn">Send</button>
      </div>
    </div>
  </div>

  <script>
    const chatToggler = document.querySelector(".chatbot-toggler");
    const chatWindow = document.querySelector(".chatbot-window");
    const sendBtn = document.querySelector("#send-btn");
    const chatBody = document.querySelector("#chat-body");
    const userInput = document.querySelector("#user-input");

    chatToggler.addEventListener("click", () => {
      chatWindow.style.display =
        chatWindow.style.display === "flex" ? "none" : "flex";
    });

    sendBtn.addEventListener("click", sendMessage);
    userInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    // =========== SEND MESSAGE ===========
    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message) return;

      appendMessage(message, "user");
      userInput.value = "";

      const reply = await processMessage(message);
      appendMessage(reply, "bot");

      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // ADD MESSAGE TO CHAT
    function appendMessage(text, sender) {
      const msg = document.createElement("div");
      msg.classList.add(sender === "user" ? "user-message" : "bot-message");
      msg.innerHTML = text;
      chatBody.appendChild(msg);
    }

    // =========== PROCESS USER QUERY ===========
    async function processMessage(input) {
      let msg = input.toLowerCase();

      if (msg.includes("login")) return "Click the login button at the top.";
      if (msg.includes("signup")) return "Use the sign up button to register.";
      if (msg.includes("help"))
        return "I can help with courses, login, and YouTube study videos!";

      const grade = extractGrade(msg);
      const subject = extractSubject(msg);

      console.log("DETECTED ‚Üí Grade:", grade, "Subject:", subject); // DEBUG

      if (grade && subject) {
        return await fetchYouTubeVideos(subject, grade);
      }

      return (
        "I can recommend videos. Try asking:<br>" +
        "<b>Recommend maths video for class 7</b>"
      );
    }

    // =========== FIND GRADE ===============
    function extractGrade(text) {
      const match = text.match(/class\s?(\d{1,2})/);
      return match ? match[1] : null;
    }

    // =========== FIND SUBJECT =============
    function extractSubject(text) {
      const subjects = [
        "math",
        "science",
        "english",
        "sst",
        "social",
        "physics",
        "chemistry",
        "bio",
        "biology",
        "hindi",
      ];

      for (let sub of subjects) {
        if (text.includes(sub)) return sub;
      }
      return null;
    }

    // =========== YOUTUBE API CALL ===========
    async function fetchYouTubeVideos(subject, grade) {
      const API_KEY = "AIzaSyBGzYB903ksAQzCiB01th0id680nclTQr8"; // FIXED KEY
      const query = `${subject} class ${grade} chapter`;

      console.log("SEARCH QUERY:", query); // DEBUG

      const url =
        "https://www.googleapis.com/youtube/v3/search?part=snippet&q=" +
        encodeURIComponent(query) +
        "&key=" +
        API_KEY +
        "&type=video&maxResults=3";

      try {
        const response = await fetch(url);

        console.log("API STATUS:", response.status); // DEBUG

        const data = await response.json();
        console.log("API DATA:", data); // DEBUG

        if (!data.items || data.items.length === 0) {
          return "Sorry, I couldn't find videos for that topic.";
        }

        let reply = `<b>Top YouTube Videos for ${subject.toUpperCase()} - Class ${grade}:</b><br><br>`;

        data.items.forEach((video, i) => {
          const title = video.snippet.title;
          const videoId = video.id.videoId;
          const link = `https://www.youtube.com/watch?v=${videoId}`;

          reply += `${i + 1}. <a href="${link}" target="_blank">${title}</a><br><br>`;
        });

        return reply;
      } catch (err) {
        console.error("API ERROR:", err); // DEBUG
        return (
          "‚ùå Error fetching videos.<br>" +
          "Possible reasons:<br>" +
          "‚Ä¢ API key restricted<br>" +
          "‚Ä¢ Not running on a server (use Live Server)<br>" +
          "‚Ä¢ YouTube API disabled<br>"
        );
      }
    }
  </script>
</div>

</body>
<script>
  history.pushState(null, null, location.href);
  window.onpopstate = function () {
    history.go(1);
  };
</script>

</html>
